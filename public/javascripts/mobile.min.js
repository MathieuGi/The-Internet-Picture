var stripe=Stripe('pk_live_43dsseaXvLZKULQhHcLRlXKe');var elements=stripe.elements();var style={base:{fontSize:'40px'},invalid:{color:'#fa755a',iconColor:'#fa755a'}};var card=elements.create('card',{hidePostalCode:true,style:style});$(document).ready(function(){$(function(){$('[data-toggle="popover"]').popover()});var g=$('.footer');$('.menu-item').click(function(e){var a=$(this).attr('id');$('.menu-item').removeClass('active');$(this).addClass('active');$('.main-area').hide();$('.'+a).show();g.css('margin-top',0);if(a!=="picture-area"){$('.social-div').hide()}else{$('.social-div').show()}var b=window.getSelection();b.removeAllRanges();e.stopPropagation()});$('.increase-bid').click(function(){var a=$(this).data('id');l(a)});$('.back-button').click(function(){h=true;$('#increase-bid-area').html("");$('.form-price-label').html('Montant');$('#menu').show();$('.main-area').hide();$('.rank-table-area').show();$('.back-button').hide();$('.name-group, .image-group, .link-group, .text-group').show()});$('.rank-table').on('click','.see-more',function(){var b=$(this).data('offset');$('.rank-table .see-more').hide();$('.rank-table .loading').show();$.ajax({type:'GET',url:'/getBidsList',data:{offset:b},success:function(a){$('#load-more').replaceWith(a);$('.rank-table .see-more').data('offset',b+10)},error:function(a){console.log('error')}})});$('.rank-table').on('click','.thumbs',function(a){a.preventDefault();var b=$('<img />',{id:'ranked-image-fullSize',src:'images/fullsize/'+$(this).data('img'),alt:"Image plein écran"});var c=$('<span>',{class:'close',html:'X'});$('.black-container').html(b);$('.black-container').prepend(c);$('.black-container').show();$('.black-container').css('display','flex');a.stopPropagation()});$('.black-container').on('click',function(){$('.black-container').hide()});$('.black-container').on('click','#ranked-image-fullSize',function(a){a.stopPropagation()});$('.rank-table').on('click','.line-ranked-table',function(){var a=$(this).data('url');if(a!==""){window.open(a,'_blank')}});$('#paiement-form .form-price').keyup(function(){var a=$('#paiement-form .form-price');var b=$('#paiement-form .form-price').val().split(".");var c="";if(b.length===2){c=b[1].slice(0,2);a.val(b[0]+'.'+c)}});var h=true;$('#trump').click(function(e){$(':focus').blur();if($('#paiement').is(':visible')){$('.paiement').hide()}else{if(o(1)){$('.paiement').show();$(window).scrollTop($('#card-element').offset().top-40);$('#card-element').focus()}}e.preventDefault()});var i=$('#paiement-form');i.submit(function(e){e.preventDefault();$(':focus').blur();if(!o(2)){e.preventDefault();e.stopPropagation()}else{e.preventDefault();e.stopPropagation();$('.invalid-feedback').hide();$('#paiement-form .confirm-button').hide();$('#paiement-form .loading').show();var a={name:$('#form-card-name').val()};stripe.createToken(card,a).then(setOutcome)}});$('#form-image').change(function(){var a=this.value.replace(/C:\\fakepath\\/i,'');$('#form-image-text').html(a)});(function(d,s,a){var b,fjs=d.getElementsByTagName(s)[0];if(d.getElementById(a))return;b=d.createElement(s);b.id=a;b.src='https://connect.facebook.net/fr_FR/sdk.js#xfbml=1&version=v2.11';fjs.parentNode.insertBefore(b,fjs)}(document,'script','facebook-jssdk'));window.twttr=(function(d,s,a){var b,fjs=d.getElementsByTagName(s)[0],t=window.twttr||{};if(d.getElementById(a))return t;b=d.createElement(s);b.id=a;b.src="https://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(b,fjs);t._e=[];t.ready=function(f){t._e.push(f)};return t}(document,"script","twitter-wjs"));card.mount('#card-element');var j='';function setOutcome(a){var b=document.querySelector('.success');var c=document.querySelector('.error');b.classList.remove('visible');c.classList.remove('visible');if(a.token){j=a.token.id;b.querySelector('.token').textContent=a.token.id;b.classList.add('visible');if(h){m(j)}else{n(j)}}else if(a.error){$('#paiement-form .loading').hide();$('#paiement-form .confirm-button').show();c.textContent=a.error.message;c.classList.add('visible')}}card.on('change',function(a){setOutcome(a)});$('#bid-summary-container').on('click','.reload-image',function(e){$('#bid-summary .img img').replaceWith($('#bid-summary .img div').html())});$('#bid-summary-container').on('click','#bid-summary .confirm .paye',function(e){e.preventDefault();$(':focus').blur();$('#bid-summary .confirm .paye').hide();$('#bid-summary .confirm .loading').css('display','inline-flex');var b='/confirmBid';var c=$('#bid-summary').data('id');var d=$('#form-email').val();var f=typeof $('.bid-to-increase').data('id')!=='undefined'?$('.bid-to-increase').data('id'):"";$.ajax({type:'POST',url:b,data:{id:c,token:j,email:d,oldId:f},success:function(a){location.reload()},error:function(a){if(a.responseJSON.error==='PriceTooLow'){alert('Un nouvel encherisseur vous a pris de vitesse !');$('#menu').show();$('.bid-more').show();$('#bid-summary-container').hide()}else{alert("Une erreur est survenue lors du paiement. Votre carte n'a pas été débitée.");location.reload()}}})});$('#bid-summary-container').on('click','#bid-summary .confirm .modify',function(e){e.preventDefault();$(':focus').blur();$('#menu').show();$('#bid-summary-container').hide();$('.bid-more').show()});function updateDomAfterNewBid(b){if($('.picture-area').is(':visible')){$('.picture-area').fadeTo(400,0,function(){$('.picture-area').html(b.newHomepage);setTimeout(function(){$('.picture-area').fadeTo(300,1)},200)})}else{$('.picture-area').html(b.newHomepage)}$('.line-ranked-table .index').each(function(a){$(this).html(a+2+".")});$('.rank-table .table tbody').prepend(b.newTableRow);$('.bid-value').html(b.bestBid.price/100);$('#paiement-form .min-bid-value').html((b.bestBid.price+1)/100);$('.min-price').val((b.bestBid.price+1)/100);$('.paiement-success').show().delay(2500).fadeOut(2000)}function removeOldBid(b){$('.rank-table tr[data-id="'+b.oldId+'"]').remove();$('.rank-table .index').each(function(a){if(a!==0){this.value=a+1}})}var k=io.connect(window.location.host);k.on('newBidder',function(a){updateDomAfterNewBid(a)});k.on('removeOldBid',function(a){removeOldBid(a)});var l=function(b){url="/getBidInfo";$.ajax({type:'GET',url:url,data:{id:b},success:function(a){h=false;$('#increase-bid-area').html(a);$('.form-price-label').html('Montant de la relance');$('#menu').hide();$('.main-area').hide();$('.bid-more').show();$('.back-button').show();$('.name-group, .image-group, .link-group, .text-group').hide()},error:function(){alert('Une erreur est survenue')}})};var m=function(b){$('.error-message').hide();if($('#form-image').length&&b!=0){var c='/createBid';var d=new FormData();d.append('image',$('#form-image')[0].files[0]);d.append('name',$('#form-name').val());d.append('url',$('#form-url').val());d.append('text',$('#form-text').val());d.append('price',$('#form-price').val());d.append('token',b);$.ajax({type:'POST',url:c,data:d,cache:false,contentType:false,processData:false,success:function(a){$('#paiement-form .loading').hide();$('#paiement-form .confirm-button').show();$('#bid-summary-container').html(a);$('#menu').hide();$('.bid-more').hide();$('#bid-summary-container').show();$(window).scrollTop(0)},error:function(a){$('#paiement-form .loading').hide();$('#paiement-form .confirm-button').show();if(a.responseJSON.error=='wrongType'){$('#wrongImageType').show()}else if(a.responseJSON.error=='missingField'){$('#mandatoryFields').show()}else if(a.responseJSON.error=='wrongFieldsType'){$('#paiement-form .invalid-feedback').show()}else if(a.responseJSON.error=='noImage'){$('#paiement-form #noImage').show()}else{$('#submitFailed').show()}}})}};var n=function(b){$('.error-message').hide();if(b!=0){var c='/increaseBid';$.ajax({type:'POST',url:c,data:{id:$('.bid-to-increase').data('id'),price:$('#form-price').val(),token:b},success:function(a){$('#paiement-form .loading').hide();$('#paiement-form .confirm-button').show();$('#bid-summary-container').html(a);$('.increase-value').replaceWith(`<tr><th><strong>Montant</strong>de la<strong>relance</strong>:</th><td class="increase-value">`+$('#form-price').val()+`€</td></tr>`);$('.total-bid-value').html('Nouveau <strong>montant</strong> de l\'<strong>enchère</strong> : ');$('.bid-more').hide();$('#bid-summary-container').show();$(window).scrollTop(0)},error:function(a){$('#paiement-form .loading').hide();$('#paiement-form .confirm-button').show();if(a.responseJSON.error=='wrongType'){$('#wrongImageType').show()}else if(a.responseJSON.error=='missingField'){$('#mandatoryFields').show()}else if(a.responseJSON.error=='wrongFieldsType'){$('#paiement-form .invalid-feedback').show()}else if(a.responseJSON.error=='noImage'){$('#paiement-form #noImage').show()}else{$('#submitFailed').show()}}})}};var o=function(a){$('.error-message').hide();if(h){if($('#form-name').val()==''){$('#mandatoryFields').show();$(window).scrollTop($('#form-name').offset().top-40);return false}else if($('#form-image').val()==''){$('#noImage').show();$(window).scrollTop($('#form-image').offset().top-40);return false}else if($('#form-image')[0].files[0].size>4000000){$('#imageToBig').show();$(window).scrollTop($('#form-image').offset().top-40);return false}else if(Number($('#form-price').val(),10)<Number($('.min-price').val(),10)){if(confirm('Attention votre enchère étant inférieure à l\'enchère actuelle la plus élevé vous ne prendrez donc pas la première place ! Votre enchère pourra toujours remonter plus tard dans le classement si une relance est effectuée par vous ou une autre personne.')){return true}else{return false}}}if($('#form-price').val()==''){$('#missing-price').show();$(window).scrollTop($('#form-price').offset().top-40);return false}else if((!$('#form-terms').prop('checked'))){$('#missing-terms').show();$(window).scrollTop($('#missing-terms').offset().top-40);return false}else if($('#form-card-name').val()===''&&a===2){$('#missing-card-name').show();$(window).scrollTop($('#missing-card-name').offset().top-40);return false}else if($('#form-email').val()!==''&&a===2){if(!isValidEmailAddress($('#form-email').val())){$('#wrong-email').show();$(window).scrollTop($('#wrong-email').offset().top-40);return false}else{return true}}else{return true}};function isValidEmailAddress(a){var b=/^([a-z\d!#$%&'*+\-\/=?^_`{|}~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+(\.[a-z\d!#$%&'*+\-\/=?^_`{|}~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+)*|"((([ \t]*\r\n)?[ \t]+)?([\x01-\x08\x0b\x0c\x0e-\x1f\x7f\x21\x23-\x5b\x5d-\x7e\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|\\[\x01-\x09\x0b\x0c\x0d-\x7f\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))*(([ \t]*\r\n)?[ \t]+)?")@(([a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|[a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF][a-z\d\-._~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]*[a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])\.)+([a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|[a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF][a-z\d\-._~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]*[a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])\.?$/i;return b.test(a)}});